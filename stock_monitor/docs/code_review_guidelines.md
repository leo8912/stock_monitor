# 代码审查规范

本文档定义了本项目的代码审查规范，旨在确保代码质量、一致性和可维护性。

## 1. 代码审查目标

1. 提高代码质量
2. 确保代码符合项目规范
3. 发现潜在缺陷和问题
4. 促进知识共享和团队协作
5. 保持代码库的一致性

## 2. 代码审查原则

### 2.1 审查态度
- 以建设性的方式提出意见
- 尊重作者的努力和工作
- 关注代码本身而非个人
- 保持开放的心态接受建议

### 2.2 审查标准
- 代码是否符合项目编码规范
- 功能实现是否正确完整
- 代码是否易于理解和维护
- 是否存在潜在的性能问题
- 是否有适当的错误处理
- 是否包含必要的测试用例

## 3. 代码规范审查

### 3.1 命名规范
- [ ] 类名使用 PascalCase（首字母大写）
- [ ] 函数和变量名使用 snake_case（下划线分隔）
- [ ] 常量使用 UPPER_CASE（大写字母加下划线）
- [ ] 私有成员使用下划线前缀（如 `_private_method`）
- [ ] 命名是否具有描述性，避免使用单字母变量名

### 3.2 代码风格
- [ ] 遵循 PEP 8 Python 代码风格指南
- [ ] 缩进使用 4 个空格
- [ ] 行长度不超过 79 个字符
- [ ] 适当使用空行分隔代码块
- [ ] 导入语句按照标准库、第三方库、本地库的顺序排列

### 3.3 文档字符串
- [ ] 所有公共函数和类都有文档字符串
- [ ] 文档字符串格式符合规范
- [ ] 参数和返回值有清晰的说明
- [ ] 包含必要的异常说明

### 3.4 类型提示
- [ ] 函数参数和返回值有适当的类型提示
- [ ] 使用了标准库的 typing 模块
- [ ] 复杂类型有清晰的定义

## 4. 设计质量审查

### 4.1 函数设计
- [ ] 函数职责单一，功能明确
- [ ] 函数长度适中（通常不超过 50 行）
- [ ] 避免过深的嵌套层次
- [ ] 合理使用辅助函数分解复杂逻辑

### 4.2 类设计
- [ ] 类的职责清晰单一
- [ ] 公共接口设计合理
- [ ] 私有成员封装良好
- [ ] 继承和多态使用恰当

### 4.3 模块设计
- [ ] 模块功能内聚
- [ ] 模块间耦合度低
- [ ] 依赖关系清晰合理

## 5. 功能实现审查

### 5.1 正确性
- [ ] 功能实现符合需求
- [ ] 边界条件处理得当
- [ ] 异常情况考虑周全
- [ ] 算法逻辑正确无误

### 5.2 错误处理
- [ ] 有适当的异常捕获和处理
- [ ] 错误信息清晰有意义
- [ ] 资源释放和清理正确
- [ ] 无内存泄漏或资源泄露风险

### 5.3 性能考虑
- [ ] 避免不必要的重复计算
- [ ] 数据结构选择合理
- [ ] 循环和递归效率良好
- [ ] 数据库和网络访问优化

## 6. 测试审查

### 6.1 测试覆盖
- [ ] 新增功能有相应的单元测试
- [ ] 测试覆盖关键业务逻辑
- [ ] 包含边界条件和异常情况测试
- [ ] 测试用例设计合理且充分

### 6.2 测试质量
- [ ] 测试代码符合规范
- [ ] 测试函数职责单一
- [ ] 测试数据清晰明确
- [ ] 断言使用恰当准确

## 7. 安全性审查

### 7.1 输入验证
- [ ] 外部输入有适当的验证
- [ ] 防止 SQL 注入等攻击
- [ ] 文件路径访问安全性
- [ ] 权限控制得当

### 7.2 数据保护
- [ ] 敏感信息处理安全
- [ ] 密码和密钥妥善保管
- [ ] 日志记录不包含敏感信息

## 8. 可维护性审查

### 8.1 代码可读性
- [ ] 代码结构清晰易懂
- [ ] 注释清晰有用，解释"为什么"而非"是什么"
- [ ] 复杂逻辑有适当注释
- [ ] 魔法数字和字符串有常量定义

### 8.2 扩展性
- [ ] 代码易于扩展和修改
- [ ] 配置和硬编码分离
- [ ] 接口设计考虑未来变化

## 9. 审查流程

### 9.1 提交前自查
作者在提交 Pull Request 前应：
1. 运行所有测试并确保通过
2. 检查代码风格和规范
3. 确认变更日志已更新
4. 自我审查代码质量

### 9.2 审查过程
1. 至少一名团队成员进行代码审查
2. 审查应在 24-48 小时内完成
3. 提出具体、可操作的修改建议
4. 严重问题必须修复后才能合并

### 9.3 审查结果
- **Approve**: 代码符合要求，可以合并
- **Request Changes**: 需要修改后重新审查
- **Comment**: 仅提供评论建议，不阻止合并

## 10. 审查关注点优先级

### 10.1 高优先级（必须修复）
1. 安全漏洞
2. 功能错误
3. 内存泄漏
4. 性能严重问题
5. 违反编码规范

### 10.2 中优先级（建议修复）
1. 代码可读性问题
2. 设计不够优雅
3. 潜在的维护困难
4. 测试覆盖不足

### 10.3 低优先级（可选建议）
1. 代码风格优化
2. 命名改善
3. 注释完善

## 11. 常见问题检查清单

### 11.1 通用问题
- [ ] 是否有未使用的导入或变量
- [ ] 是否有硬编码的魔法数字
- [ ] 是否有重复的代码片段
- [ ] 是否有过于复杂的条件判断

### 11.2 性能问题
- [ ] 循环中是否有不必要的重复计算
- [ ] 是否有可以缓存的结果
- [ ] 数据库查询是否优化
- [ ] 是否有阻塞主线程的操作

### 11.3 安全问题
- [ ] 用户输入是否经过验证
- [ ] 是否有潜在的注入风险
- [ ] 敏感信息是否得到保护
- [ ] 权限检查是否到位

## 12. 工具辅助审查

### 12.1 自动化工具
1. 使用 pylint/flake8 检查代码风格
2. 使用 mypy 检查类型提示
3. 使用 bandit 检查安全问题
4. 使用 coverage 检查测试覆盖率

### 12.2 IDE 支持
1. 使用 PyCharm 或 VS Code 等现代 IDE
2. 配置实时语法检查和规范提示
3. 利用代码重构功能改善设计

## 13. 持续改进

### 13.1 定期回顾
- 每季度回顾和更新审查规范
- 根据项目发展调整审查重点
- 收集团队反馈优化流程

### 13.2 知识分享
- 定期组织代码审查经验分享
- 建立常见问题和解决方案知识库
- 鼓励团队成员互相学习和提高
