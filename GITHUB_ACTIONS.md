# GitHub Actions 自动构建说明

## 🚀 概述

本项目配置了GitHub Actions工作流，当代码发生变化时会自动构建并发布软件。

## 📋 工作流配置

### 1. 🚀 自动发布工作流 (`release.yml`)
- **触发条件**：推送`main.py`到main分支 **或** 手动触发
- **功能**：自动构建、创建GitHub Release、上传可执行文件
- **版本号**：自动生成（格式：v1.0.YYYYMMDD-commit）
- **适用场景**：正式发布版本
- **手动触发**：✅ 支持

### 2. 🔨 完整构建工作流 (`build.yml`)
- **触发条件**：核心文件变化时触发 **或** 手动触发
- **功能**：完整构建流程，包含依赖处理
- **产物**：上传构建产物到Actions（不创建Release）
- **适用场景**：测试构建、验证依赖
- **手动触发**：✅ 支持

### 3. ⚡ 快速构建工作流 (`quick-build.yml`)
- **触发条件**：`main.py`变化 **或** 手动触发
- **功能**：快速构建，适合测试
- **产物**：上传构建产物到Actions
- **适用场景**：快速测试、调试
- **手动触发**：✅ 支持

## 🔧 使用方法

### 自动触发
1. 修改`main.py`文件
2. 提交并推送到GitHub
3. 工作流自动运行
4. 查看构建结果和下载链接

### 手动触发
1. 进入GitHub仓库页面
2. 点击"Actions"标签
3. 选择需要的工作流：
   - **🚀 Auto Release**：创建正式发布版本
   - **🔨 Build Stock Monitor**：测试构建过程
   - **⚡ Quick Build**：快速构建测试
4. 点击"Run workflow"按钮

### 🎯 工作流选择指南

| 场景 | 推荐工作流 | 说明 |
|------|------------|------|
| 正式发布 | 🚀 Auto Release | 创建GitHub Release，适合正式版本 |
| 测试构建 | 🔨 Build Stock Monitor | 验证构建过程，不上传Release |
| 快速调试 | ⚡ Quick Build | 最快构建，适合频繁测试 |
| 依赖验证 | 🔨 Build Stock Monitor | 完整依赖处理，验证环境 |

## 📥 下载构建产物

### 方法1：GitHub Releases
- 访问仓库的Releases页面
- 下载最新版本的`stock_monitor.exe`

### 方法2：Actions Artifacts
- 进入Actions页面
- 点击具体的构建任务
- 下载构建产物

## ⚙️ 配置说明

### 权限设置
工作流需要以下权限：
- `contents: write` - 创建Release
- `packages: write` - 上传构建产物

### 环境要求
- Python 3.9
- Windows运行环境
- PyInstaller
- 项目依赖库

## 🐛 故障排除

### 常见问题

1. **构建失败**
   - 检查依赖是否正确安装
   - 查看构建日志中的错误信息
   - 确保所有必要文件存在

2. **权限错误**
   - 确保仓库设置了正确的权限
   - 检查GitHub Token是否有效

3. **文件缺失**
   - 确保`icon.ico`、`icon.png`等文件存在
   - 检查`requirements.txt`是否完整

### 调试方法

1. **查看构建日志**
   - 进入Actions页面
   - 点击具体的构建任务
   - 查看详细的构建日志

2. **本地测试**
   - 使用`build.py`脚本本地测试
   - 确保本地环境与GitHub Actions一致

3. **手动触发**
   - 使用手动触发功能测试工作流
   - 逐步排查问题

## 📝 注意事项

1. **构建时间**：每次构建大约需要5-10分钟
2. **存储限制**：构建产物保留30天
3. **版本管理**：每次构建都会创建新的Release
4. **依赖更新**：修改`requirements.txt`会触发重新构建

## 🔄 更新工作流

如需修改工作流配置：

1. 编辑`.github/workflows/`下的YAML文件
2. 提交更改
3. 推送到GitHub
4. 工作流会自动使用新配置

## 📞 支持

如果遇到问题：
1. 查看构建日志
2. 检查配置文件
3. 提交Issue描述问题
4. 提供详细的错误信息 